// Recommendations data (embedded as fallback)
const recommendationsData = {
  "recommendations": [
    {
      "text": "I've had the opportunity to work closely with Pasindu, and I can confidently say he is an exceptional professional. He combines strong technical expertise with a genuine team-oriented mindset. From the very beginning, Pasindu consistently demonstrated his ability to quickly understand and adapt to new technologies and concepts. Whether dealing with Google VMs, Reactjs, Fast API, databases, or complex technical challenges, he approaches each task with confidence and delivers reliable solutions. What truly sets him apart is his collaborative nature and clear communication. He is always willing to support his teammates, explain complex ideas, and contribute meaningful insights during discussions and brainstorming sessions. His positive attitude and readiness to help have had a noticeable impact on both team productivity and morale. He actively seeks opportunities to learn, keeps himself up to date with industry trends, and often brings forward valuable ideas that enhance our projects. Overall, Pasindu is a committed and highly capable software engineer. I strongly recommend him for any role—he would undoubtedly be a valuable addition to any team.",
      "author": {
        "name": "Krishnamenan Rasenthira",
        "title": "We help global tech companies hire Asia's top 3% vetted talent — faster, smarter, and fully remote via talport.ai",
        "linkedin": "https://www.linkedin.com/in/krishnamenan-rasenthira"
      }
    },
    {
      "text": "I had the pleasure of working with Pasindu Dhanushka Uduwela at Talport, where he served as a Full-Stack Engineer. Pasindu played a key role in designing and building our platform's architecture — from frontend and backend development to cloud deployment, CI/CD automation, and system security. He consistently delivers clean, scalable, and reliable solutions, and approaches engineering challenges with strong system-level thinking and ownership. His ability to combine technical execution with product understanding made a real impact on our platform. I highly recommend Pasindu to any team looking for a skilled and dependable full-stack engineer.",
      "author": {
        "name": "Gobinthiran Kulendran",
        "title": "Building talport.ai — Hire From Sri Lanka's Top 0.1% Engineers · Silicon Valley–grade verified by Ex-FAANG",
        "linkedin": "https://www.linkedin.com/in/gobinthiran-kulendran"
      }
    },
    {
      "text": "I had the privilege of working closely with Pasindu on the SIMedia project at Drifting Desk—a hospitality-focused digital marketing platform enhanced with AI to support smarter bookings and campaigns. Pasindu is a dedicated, innovative, and technically brilliant .NET developer who constantly impressed the team with his problem-solving mindset and ability to handle anything thrown his way. His expertise spans across the .NET ecosystem, Kafka-driven recurring and scheduled jobs, Hangfire-based background processing, Redis caching strategies, and Keycloak-based authentication. He has a sharp understanding of system architecture and consistently delivered clean, scalable solutions—whether building from scratch or optimizing complex pipelines. Pasindu not only delivers with precision but leads with creativity and confidence. He's the kind of engineer you can trust to take full ownership of a feature or project and see it through with excellence.",
      "author": {
        "name": "Nishad Ahamed",
        "title": "Senior AI Engineer | AI for Game Testing & Crash Analysis Researcher | NLP, Computer Vision & LLMs",
        "linkedin": "https://www.linkedin.com/in/nishad-ahamed"
      }
    },
    {
      "text": "As a software engineer at ICP Technologies for the past year, I have had the privilege of working closely with Pasindu. From the very beginning, Pasindu has stood out for his technical talents, unwavering dedication to our team's objectives, and proactive approach to solving problems. In addition to his technical expertise, Pasindu has exhibited outstanding qualities as a learner and collaborator. His enthusiasm for adopting new technologies and methodologies has been inspiring, propelling our team towards innovation and continuous improvement. I would like to highlight an exemplary instance that showcases Pasindu's technical talent: his implementation of the outbox pattern in our project to stabilize message communication between the application and the message broker, such as RabbitMQ. Pasindu played a pivotal role in this implementation, including designing the Entity-Relationship (ER) diagram and the process diagram. These diagrams elucidate how the process is managed and have proven invaluable in enabling team members to grasp the techniques and progress swiftly. Pasindu is always eager to share his knowledge and experience, mentoring team members and disseminating valuable insights. Most importantly, he has shown an exceptional ability to listen, adapt, quickly grasp technical terms, and respond to feedback. This attribute, combined with his technical skills, makes him a valued team player in the organization. Having observed his professional growth and contributions firsthand, I can attest to Pasindu's exceptional abilities as a .NET developer and a dedicated team member. His technical expertise, coupled with his positive attitude and willingness to go the extra mile, makes him an invaluable asset to the organization. I can guarantee that Pasindu will continue to achieve great success and bring his remarkable talents to any organization seeking to enhance their team with a skilled, experienced, and collaborative developer.",
      "author": {
        "name": "Sevitha Heshanjith",
        "title": "Senior Software Engineer | Backend Developer | C# | .NET | Azure | AzureDevOps",
        "linkedin": "https://www.linkedin.com/in/sevitha-heshanjith"
      }
    },
    {
      "text": "I had the pleasure of working alongside Pasindu for one years at ICP Technology. Pasindu is an exceptional software engineer with a strong command of Java programming and a knack for writing clean, efficient code. His solutions were always well-structured and easy to maintain, reflecting his deep understanding of software architecture and best practices. Pasindu excels not only as a developer but also as a team player. He actively contributed to our team's success by fostering collaboration, sharing knowledge, and consistently supporting his peers. His positive attitude and willingness to take on challenges made him a valuable asset to our projects. One of Pasindu's standout strengths is his impressive problem-solving skills. He approached complex issues methodically and effectively, often proposing innovative solutions that significantly improved project outcomes. His ability to analyze problems and implement solutions swiftly was instrumental in overcoming technical hurdles. Moreover, Pasindu is a quick learner who eagerly embraces new technologies and methodologies. He consistently demonstrated his adaptability and readiness to expand his skill set, making him invaluable in dynamic, fast-paced environments. I highly recommend Pasindu for his technical proficiency, collaborative spirit, problem-solving acumen, and dedication to continuous learning. He would undoubtedly be a valuable addition to any team seeking a skilled and versatile software engineer.",
      "author": {
        "name": "Kusal M.",
        "title": "Senior Software Engineer | BSc (Hons) | MBA | Java | Spring Boot| .Net | MySql | QA testing | FinTech",
        "linkedin": "https://www.linkedin.com/in/kusal-m"
      }
    },
    {
      "text": "I've had the pleasure of working with Pasindu for a one year, and I can't say enough good things about him. Pasindu is not only technically skilled but also a fantastic team player. From day one, he has impressed me with his ability to pick up new technologies and concepts quickly. Whether it's related to dotnet core, RabbitMQ, design patterns, databases or any other challenging problem, Pasindu always rises to the occasion. His code is clean, efficient, and well-documented, making everyone's job easier. What really stands out about Pasindu is his willingness to help others and his excellent communication skills. He is always ready to jump in and support a teammate, explain a concept, or offer a fresh perspective during brainstorming sessions. This collaborative spirit has made a big difference in our team's productivity and morale. Beyond his technical abilities, Pasindu is proactive and always looking for ways to improve. He is keen on learning and staying current with industry trends, which has led to some great ideas and improvements in our projects. In short, Pasindu is a dedicated and talented software engineer. I highly recommend him for any role he'll be an asset to any team.",
      "author": {
        "name": "Ranushka Pasindu",
        "title": "Backend Specialist | .NET Core, C#, Microsoft technologies | Scalable API & Cloud Architecture | 5+ Years",
        "linkedin": "https://www.linkedin.com/in/ranushka-pasindu"
      }
    }
  ]
};

// Function to escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Function to open modal with full recommendation
function openRecommendationModal(recommendation) {
    const modal = document.getElementById('recommendationModal');
    const modalContent = document.getElementById('modalContent');
    
    if (!modal || !modalContent) {
        return;
    }
    
    const text = escapeHtml(recommendation.text);
    const name = escapeHtml(recommendation.author.name);
    const title = escapeHtml(recommendation.author.title);
    const linkedin = recommendation.author.linkedin;
    
    modalContent.innerHTML = `
        <div class="modal-recommendation-content">
            <svg class="quote-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 50px; height: 50px; color: var(--primary-color); opacity: 0.2; margin-bottom: 1.5rem;">
                <path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/>
                <path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/>
            </svg>
            <p class="modal-recommendation-text">"${text}"</p>
        </div>
        <div class="modal-recommendation-author">
            <div class="modal-author-info">
                <h4 class="modal-author-name">${name}</h4>
                <p class="modal-author-title">${title}</p>
            </div>
            <a href="${linkedin}" target="_blank" rel="noopener noreferrer" class="modal-linkedin-link" aria-label="View on LinkedIn">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
            </a>
        </div>
    `;
    
    modal.classList.add('active');
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
}

// Function to close modal
function closeRecommendationModal() {
    const modal = document.getElementById('recommendationModal');
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // Restore scrolling
    }
}

// Function to render recommendations
function renderRecommendations(data) {
    const testimonialsGrid = document.getElementById('testimonialsGrid');
    
    if (!testimonialsGrid) {
        return;
    }
    
    // Clear any existing content
    testimonialsGrid.innerHTML = '';
    
    // Create testimonial cards for each recommendation
    data.recommendations.forEach((recommendation, index) => {
        const card = document.createElement('div');
        card.className = 'testimonial-card';
        
        // Escape HTML special characters in text
        const text = escapeHtml(recommendation.text);
        const name = escapeHtml(recommendation.author.name);
        const title = escapeHtml(recommendation.author.title);
        
        // Check if text is long enough to truncate (more than ~200 characters)
        const isLongText = recommendation.text.length > 200;
        
        card.innerHTML = `
            <div class="testimonial-content">
                <svg class="quote-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/>
                    <path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/>
                </svg>
                <p class="testimonial-text">"${text}"</p>
                ${isLongText ? '<span class="read-more-indicator">Click to read more →</span>' : ''}
            </div>
            <div class="testimonial-author">
                <div class="author-info">
                    <h4 class="author-name">${name}</h4>
                    <p class="author-title">${title}</p>
                </div>
                <a href="${recommendation.author.linkedin}" target="_blank" rel="noopener noreferrer" class="linkedin-link" aria-label="View on LinkedIn" onclick="event.stopPropagation();">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                </a>
            </div>
        `;
        
        // Add click handler to open modal
        card.addEventListener('click', (e) => {
            // Don't open modal if clicking on LinkedIn link
            if (!e.target.closest('.linkedin-link')) {
                openRecommendationModal(recommendation);
            }
        });
        
        testimonialsGrid.appendChild(card);
    });
}

// Load LinkedIn Recommendations from JSON or use embedded data
async function loadRecommendations() {
    const testimonialsGrid = document.getElementById('testimonialsGrid');
    
    if (!testimonialsGrid) {
        return;
    }
    
    // Try to load from JSON file first
    try {
        const response = await fetch('recommendations.json');
        if (response.ok) {
            const data = await response.json();
            if (data && data.recommendations && data.recommendations.length > 0) {
                renderRecommendations(data);
                return;
            }
        }
    } catch (error) {
        // If fetch fails, use embedded data
    }
    
    // Fallback to embedded data
    if (recommendationsData && recommendationsData.recommendations && recommendationsData.recommendations.length > 0) {
        renderRecommendations(recommendationsData);
    } else {
        testimonialsGrid.innerHTML = `
            <div class="testimonial-card" style="grid-column: 1 / -1;">
                <p style="text-align: center; color: var(--text-secondary);">
                    No recommendations available at this time.
                </p>
            </div>
        `;
    }
}

// Setup modal close handlers
function setupModalHandlers() {
    const modal = document.getElementById('recommendationModal');
    const modalClose = document.getElementById('modalClose');
    
    if (modalClose) {
        modalClose.addEventListener('click', closeRecommendationModal);
    }
    
    if (modal) {
        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeRecommendationModal();
            }
        });
        
        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                closeRecommendationModal();
            }
        });
    }
}

// Load recommendations when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        loadRecommendations();
        setupModalHandlers();
    });
} else {
    loadRecommendations();
    setupModalHandlers();
}
